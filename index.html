<!DOCTYPE html>

<html lang="en">
<head>
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1"
    >
    <meta
        name="theme-color"
        content="#5f9ea0"
    />
    <title>Simplythiser</title>
    <link
        rel="stylesheet"
        href="css/style.css"
    >
    <!--    <link rel="manifest" href="manifest.json">-->
    <!-- Typekit -->
    <script src="//use.typekit.net/bin2ptp.js"></script>
    <script>
        try {
            Typekit.load();
        } catch (e) {
            console.log(e);
        }
    </script>
    <script src="js/AudioContextClass.js"></script>
</head>

<body style="overflow:hidden">

<h1>Simplythiser
    <button id="envelopeTrigger">Trigger</button>
</h1>
<form style="opacity: 0;">
    <fieldset>
        <legend>Oscilliscope</legend>
        <div id="oscilliscope">
            <canvas id="oscilliscopeVisualiser"></canvas>
        </div>
    </fieldset>
    <fieldset id="masterVolume">
        <legend>Master volume</legend>
        <div class="control-group">
            <label for="volume">Volume</label>
            <input
                type="range"
                min="0"
                max="10"
                step="0.1"
                value="1"
                id="volume"
                data-destination="masterVolume"
                data-parameter="gain"
            >
        </div>
        <div class="control-group">
            <label for="pan">Pan</label>
            <input
                type="range"
                min="-1"
                max="1"
                step="0.01"
                value="0"
                id="pan"
            >
        </div>
    </fieldset>
    <fieldset
        id="delay"
        class="fieldset-group"
    >
        <legend>Delay</legend>
        <div class="control-group">
            <label for="delayTime">Delay time</label>
            <input
                type="range"
                min="0"
                max="10"
                step="0.01"
                value="0.01"
                id="delayTime"
            >
        </div>
        <div class="control-group">
            <label for="delayFeedback">Feedback</label>
            <input
                type="range"
                min="0"
                max="1"
                step="0.001"
                value="0.98"
                id="delayFeedback"
            >
        </div>
    </fieldset>
    <fieldset id="dynamics">
        <legend>Dynamics</legend>
        <div class="control-group">
            <label for="dynamicsThreshold">Threshold</label>
            <input
                type="range"
                min="-100"
                max="0"
                step="0.1"
                value="-24"
                id="dynamicsThreshold"
            >
        </div>
        <div class="control-group">
            <label for="dynamicsKnee">Knee</label>
            <input
                type="range"
                min="0"
                max="40"
                step="1"
                value="30"
                id="dynamicsKnee"
            >
        </div>
        <div class="control-group">
            <label for="dynamicsRatio">Ratio</label>
            <input
                type="range"
                min="1"
                max="20"
                step="0.1"
                value="12"
                id="dynamicsRatio"
            >
        </div>
        <div class="control-group">
            <label for="dynamicsAttack">Attack</label>
            <input
                type="range"
                min="0"
                max="1"
                step="0.001"
                value="0.003"
                id="dynamicsAttack"
            >
        </div>
        <div class="control-group">
            <label for="dynamicsRelease">Release</label>
            <input
                type="range"
                min="0"
                max="1"
                step="0.001"
                value="0.25"
                id="dynamicsRelease"
            >
        </div>
    </fieldset>
    <fieldset id="vca">
        <legend>VCA</legend>
        <div class="control-group">
            <label for="envelopeLevel">Peak level</label>
            <input
                type="range"
                min="-1"
                max="1"
                step="0.01"
                value="1.00"
                id="envelopeLevel"
            >
        </div>
        <div class="control-group">
            <label for="envelopeAttack">Attack time</label>
            <input
                type="range"
                min="0"
                max="40"
                step="0.01"
                value="4.00"
                id="envelopeAttack"
            >
        </div>
        <div class="control-group">
            <label for="envelopeDecay">Decay time</label>
            <input
                type="range"
                min="0.1"
                max="40"
                step="0.01"
                value="4.00"
                id="envelopeDecay"
            >
        </div>
        <div class="control-group">
            <label for="envelopeSustain">Sustain level</label>
            <input
                type="range"
                min="0"
                max="1"
                step="0.01"
                value="0.50"
                id="envelopeSustain"
            >
        </div>
        <div class="control-group">
            <label for="envelopeHold">Hold time</label>
            <input
                type="range"
                min="0"
                max="40"
                step="0.01"
                value="10.0"
                id="envelopeHold"
            >
        </div>
        <div class="control-group">
            <label for="envelopeRelease">Release time</label>
            <input
                type="range"
                min="0"
                max="40"
                step="0.01"
                value="5.0"
                id="envelopeRelease"
            >
        </div>
        <div class="control-group">
            <label for="vcaDistortion">Distortion</label>
            <input
                type="range"
                min="0"
                max="8000"
                step="1"
                value="800"
                id="vcaDistortion"
            >
        </div>
    </fieldset>
    <fieldset id="filter1">
        <legend>Filter</legend>
        <canvas
            id="filterVisualiser"
            width="500"
            height="200"
        ></canvas>
        <div class="span-6">
            <div class="control-group">
                <label for="filter1frequency">Filter frequency</label>
                <input
                    type="range"
                    min="1"
                    max="8"
                    step="0.001"
                    value="1.5"
                    id="filter1frequency"
                >
            </div>
            <div class="control-group">
                <label for="filter1Q">Filter Q</label>
                <input
                    type="number"
                    min="0.0001"
                    max="1000"
                    step="0.0001"
                    value="25"
                    id="filter1Q"
                >
            </div>
            <div class="control-group">
                <label for="filter1Gain">Filter gain</label>
                <input
                    type="range"
                    min="-40"
                    max="40"
                    value="0"
                    id="filter1Gain"
                >
            </div>
            <div class="control-group">
                <label for="filter1Type">Filter type</label>
                <select id="filter1Type">
                    <option value="lowpass">Low Pass</option>
                    <option
                        value="bandpass"
                        selected
                    >Band Pass
                    </option>
                    <option value="highpass">High Pass</option>
                    <option value="lowshelf">Low Shelf</option>
                    <option value="highshelf">High Shelf</option>
                    <option value="peaking">Peaking</option>
                    <option value="notch">Notch</option>
                    <option value="allpass">All Pass</option>
                </select>
            </div>
        </div>
        <div class="span-6">
            <div class="control-group">
                <label for="filter1LfoFrequency">Filter LFO frequency</label>
                <input
                    type="range"
                    min="0.01"
                    max="8"
                    step="0.01"
                    value="0.01"
                    id="filter1LfoFrequency"
                >
            </div>
            <div class="control-group">
                <label for="lfo1Type">Filter LFO waveform</label>
                <select id="lfo1Type">
                    <option value="sine">Sine</option>
                    <option value="square">Square</option>
                    <option value="sawtooth">Sawtooth</option>
                    <option value="triangle">Triangle</option>
                </select>
            </div>
            <div class="control-group">
                <label for="filter1LfoGain">Filter LFO gain</label>
                <input
                    type="range"
                    min="0"
                    max="100"
                    step="0.1"
                    value="100"
                    id="filter1LfoGain"
                >
            </div>
        </div>
    </fieldset>
    <fieldset
        id="oscillators"
        class="fieldset-group"
    >
        <legend>Oscillators</legend>
        <div class="control-group">
            <label for="oscillator1Octave">Osc1 frequency</label>
            <input
                type="range"
                min="1"
                max="8"
                step="0.001"
                value="1.5"
                id="oscillator1Octave"
            >
        </div>
        <div class="control-group">
            <label for="oscillator2Detune">Osc2 detune</label>
            <input
                type="range"
                min="-100"
                max="100"
                value="3"
                id="oscillator2Detune"
            >
        </div>
        <div class="control-group">
            <label for="oscillator2Octave">Osc2 octave</label>
            <input
                type="range"
                min="-2"
                max="2"
                step="1"
                value="-2"
                id="oscillator2Octave"
            >
        </div>
        <div class="control-group">
            <label for="oscillator1Type">Osc1 waveform</label>
            <select id="oscillator1Type">
                <option value="sine">Sine</option>
                <option
                    value="square"
                    selected
                >Square
                </option>
                <option value="sawtooth">Sawtooth</option>
                <option value="triangle">Triangle</option>
            </select>
        </div>
        <div class="control-group">
            <label for="oscillator2Type">Osc2 waveform</label>
            <select id="oscillator2Type">
                <option value="sine">Sine</option>
                <option value="square">Square</option>
                <option
                    value="sawtooth"
                    selected
                >Sawtooth
                </option>
                <option value="triangle">Triangle</option>
            </select>
        </div>
    </fieldset>
</form>
<button
    onClick="initSimplethiser()"
    type="button"
    class="init-button"
>
    Start
</button>
<script src="js/simplythiser.js"></script>
<script type="text/javascript">
    simplythiser(new AudioContextClass());
    document.querySelector('#oscilliscopeVisualiser').height = '200';
    document.querySelector('#oscilliscopeVisualiser').width = document.querySelector('#oscilliscope').clientWidth;
    document.querySelector('input').addEventListener('change', function (event) {
        window[event.target.dataset.destination][event.target.dataset.parameter].exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    /*document.querySelector('#volume').addEventListener('change', function(event){
        masterVolume.gain.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02)
    });*/
    document.querySelector('#pan').addEventListener('change', function (event) {
        panner.pan.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#delayTime').addEventListener('change', function (event) {
        delay.delayTime.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#delayFeedback').addEventListener('change', function (event) {
        delayFeedback.gain.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#dynamicsThreshold').addEventListener('change', function (event) {
        compressor.threshold.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#dynamicsKnee').addEventListener('change', function (event) {
        compressor.knee.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#dynamicsRatio').addEventListener('change', function (event) {
        compressor.ratio.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#dynamicsAttack').addEventListener('change', function (event) {
        compressor.attack.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#dynamicsRelease').addEventListener('change', function (event) {
        compressor.release.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#envelopeTrigger').addEventListener('click', function (event) {
        envelope(
            context,
            gainStage.gain,
            0.0,
            parseFloat(document.querySelector('#envelopeLevel').value),
            parseFloat(document.querySelector('#envelopeAttack').value),
            parseFloat(document.querySelector('#envelopeDecay').value),
            parseFloat(document.querySelector('#envelopeSustain').value * document.querySelector('#envelopeLevel').value),
            parseFloat(document.querySelector('#envelopeHold').value),
            parseFloat(document.querySelector('#envelopeRelease').value)
        );
        //runRandomValueSequencer(context, 2, [
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}],
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}],
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}],
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}],
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}],
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}],
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}],
        //    [{target: filter1.frequency, min: 50, max: 800}],
        //    [{target: filter1.frequency, min: 250, max: 1400}]
        //    ])
    });
    document.querySelector('#vcaDistortion').addEventListener('change', function (event) {
        distortion.setCurve(Number(event.target.value));
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1frequency').addEventListener('change', function (event) {
        filter1.frequency.exponentialRampToValueAtTime(Math.pow(2, event.target.value) * 55, context.currentTime + 0.02);
    });
    document.querySelector('#filter1Q').addEventListener('change', function (event) {
        filter1.Q.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#filter1Gain').addEventListener('change', function (event) {
        filter1.gain.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#filter1Type').addEventListener('change', function (event) {
        filter1.type = event.target.value;
    });
    document.querySelector('#filter1LfoFrequency').addEventListener('change', function (event) {
        lfo1.oscillator.frequency.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#filter1LfoGain').addEventListener('change', function (event) {
        lfo1.gain.gain.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#lfo1Type').addEventListener('change', function (event) {
        lfo1.oscillator.type = event.target.value;
    });
    document.querySelector('#oscillator1Octave').addEventListener('change', function (event) {
        osc1.frequency.exponentialRampToValueAtTime(Math.pow(2, event.target.value) * 55, 0.002);
        osc2.frequency.exponentialRampToValueAtTime(osc1.frequency.value * Math.pow(2, document.querySelector('#oscillator2Octave').value), 0.02);
    });
    document.querySelector('#oscillator2Detune').addEventListener('change', function (event) {
        osc2.detune.exponentialRampToValueAtTime(event.target.value, context.currentTime + 0.02);
    });
    document.querySelector('#oscillator2Octave').addEventListener('change', function (event) {
        osc2.frequency.value = osc1.frequency.value * Math.pow(2, event.target.value);
    });
    document.querySelector('#oscillator1Type').addEventListener('change', function (event) {
        osc1.type = event.target.value;
    });
    document.querySelector('#oscillator2Type').addEventListener('change', function (event) {
        osc2.type = event.target.value;
    });
    document.querySelector('#filter1Type').addEventListener('change', function (event) {
        filter1.type = event.target.value;
    });
    document.querySelector('form').addEventListener('submit', function (event) {
        event && event.preventDefault();
    });
</script>
<!--<script>-->
<!--    if (navigator.serviceWorker.controller) {-->
<!--        console.log('[PWA Builder] active service worker found, no need to register')-->
<!--    } else {-->
<!--        //Register the ServiceWorker-->
<!--        navigator.serviceWorker.register('pwabuilder-sw.js', {-->
<!--            scope: './'-->
<!--        }).then(function(reg) {-->
<!--            console.log('Service worker has been registered for scope:'+ reg.scope);-->
<!--        });-->
<!--    }-->
<!--</script>-->
</body>
</html>
